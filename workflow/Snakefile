import pdb
from snakemake.utils import validate
import pandas as pd


configfile : "config/config.yaml"
validate(config,"schemas/config.schema.yaml")

params = pd.read_csv("config/params.tsv",sep="\t")
validate(params, "schemas/param.schema.yaml")


include: "rules/common.smk"
include: "rules/create.smk"
include: "rules/prep.smk"
include: "rules/execute.smk"
include: "rules/post.smk"

def get_post():
    """
    get a list of files that have to be created by the rule post
    """
    res = [f"results/simulations/{instance_pattern}/bladeloading.jpg"
                                            for instance_pattern in paramspace.instance_patterns]
    res += [f"results/simulations/{instance_pattern}/velocity_contour.jpg"
                                            for instance_pattern in paramspace.instance_patterns]
    res += [f"results/simulations/{instance_pattern}/residuals.jpg"
                                            for instance_pattern in paramspace.instance_patterns]
    return res

rule all:
    input: get_post()




